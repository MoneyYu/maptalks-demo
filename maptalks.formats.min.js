/*!
 * maptalks.formats v0.2.0
 * LICENSE : BSD-3-Clause
 * (c) 2016-2017 maptalks.org
 */
/*!
 * requires maptalks@^0.25.0 
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("maptalks")):"function"==typeof define&&define.amd?define(["exports","maptalks"],t):t(e.maptalks=e.maptalks||{},e.maptalks)}(this,function(e,t){"use strict";function r(e){return new Function("d","return {"+e.map(function(e,t){return JSON.stringify(e)+": d["+t+"]"}).join(",")+"}")}function n(e,t){var n=r(e);return function(r,i){return t(n(r),i,e)}}function i(e){var t=Object.create(null),r=[];return e.forEach(function(e){for(var n in e)n in t||r.push(t[n]=n)}),r}function o(e,t){return l(e,t).val}function a(e){return u(e.lat,"lat")+" "+u(e.lon,"lon")}function u(e,t){var r=s(e,t);return r.whole+"\xb0 "+(r.minutes?r.minutes+"' ":"")+(r.seconds?r.seconds+'" ':"")+r.dir}function s(e,t){var r={lat:["N","S"],lon:["E","W"]}[t]||"",n=r[e>=0?0:1],i=Math.abs(e),o=Math.floor(i),a=i-o,u=60*a,s=Math.floor(u);return{whole:o,minutes:s,seconds:Math.floor(60*(u-s)),dir:n}}function l(e,t,r){if(t||(t="NSEW"),"string"!=typeof e)return{val:null,regex:r};r=r||/[\s\,]*([\-|\\u2014|\\u2015]?[0-9.]+)\xb0? *(?:([0-9.]+)['\u2019\u2032\u2018] *)?(?:([0-9.]+)(?:''|"|\u201d|\u2033) *)?([NSEW])?/gi;var n=r.exec(e);return n?n[4]&&-1===t.indexOf(n[4])?{val:null,regex:r}:{val:((n[1]?parseFloat(n[1]):0)+(n[2]?parseFloat(n[2])/60:0)+(n[3]?parseFloat(n[3])/3600:0))*(n[4]&&"S"===n[4]||"W"===n[4]?-1:1),regex:r,raw:n[0],dim:n[4]}:{val:null,regex:r}}function c(e,t){e=e.trim();var r=l(e,t);if(null===r.val)return null;var n=l(e,t,r.regex);return null===n.val?null:r.raw+n.raw!==e?null:r.dim?f(r.val,n.val,r.dim):[r.val,n.val]}function f(e,t,r){return"N"===r||"S"===r?[e,t]:"W"===r||"E"===r?[t,e]:void 0}function p(e,t){var r,n,i;for(var o in e)(n=o.match(t))&&(!r||n[0].length/o.length>i)&&(i=n[0].length/o.length,r=o);return r}function h(e){return p(e,ct)}function d(e){return p(e,ft)}function m(e){return!!e.match(ct)}function g(e){return!!e.match(ft)}function v(e){return"object"==(void 0===e?"undefined":at(e))?Object.keys(e).length:0}function y(e){var t=[",",";","\t","|"],r=[];return t.forEach(function(t){var n=st.dsvFormat(t).parse(e);if(n.length>=1){for(var i=v(n[0]),o=0;o<n.length;o++)if(v(n[o])!==i)return;r.push({delimiter:t,arity:Object.keys(n[0]).length})}}),r.length?r.sort(function(e,t){return t.arity-e.arity})[0].delimiter:null}function N(e){return delete e.columns,e}function w(e){var t=y(e);return t?N(st.dsvFormat(t).parse(e)):null}function b(e,t,r){r||(r=t,t={}),t.delimiter=t.delimiter||",";var n=t.latfield||"",i=t.lonfield||"",o=t.crs||"",a=[],u={type:"FeatureCollection",features:a};if(""!==o&&(u.crs={type:"name",properties:{name:o}}),"auto"===t.delimiter&&"string"==typeof e&&(t.delimiter=y(e),!t.delimiter))return void r({type:"Error",message:"Could not autodetect delimiter"});var s="string"==typeof e?st.dsvFormat(t.delimiter).parse(e):e;if(!s.length)return void r(null,u);var l,c=[];if(n||(n=h(s[0])),i||(i=d(s[0])),!n||!i){for(l=0;l<s.length;l++)a.push({type:"Feature",properties:s[l],geometry:null});return void r(c.length?c:null,u)}for(l=0;l<s.length;l++)if(void 0!==s[l][i]&&void 0!==s[l][n]){var f,p,m,g=s[l][i],v=s[l][n];m=lt(g,"EW"),m&&(g=m),m=lt(v,"NS"),m&&(v=m),f=parseFloat(g),p=parseFloat(v),isNaN(f)||isNaN(p)?c.push({message:"A row contained an invalid value for latitude or longitude",row:s[l],index:l}):(t.includeLatLon||(delete s[l][i],delete s[l][n]),a.push({type:"Feature",properties:s[l],geometry:{type:"Point",coordinates:[parseFloat(f),parseFloat(p)]}}))}r(c.length?c:null,u)}function x(e){for(var t=e.features,r={type:"Feature",geometry:{type:"LineString",coordinates:[]}},n=0;n<t.length;n++)r.geometry.coordinates.push(t[n].geometry.coordinates);return r.properties=t.reduce(function(e,t){for(var r in t.properties)e[r]||(e[r]=[]),e[r].push(t.properties[r]);return e},{}),{type:"FeatureCollection",features:[r]}}function E(e){for(var t=e.features,r={type:"Feature",geometry:{type:"Polygon",coordinates:[[]]}},n=0;n<t.length;n++)r.geometry.coordinates[0].push(t[n].geometry.coordinates);return r.properties=t.reduce(function(e,t){for(var r in t.properties)e[r]||(e[r]=[]),e[r].push(t.properties[r]);return e},{}),{type:"FeatureCollection",features:[r]}}function S(e){function t(e){var t=d.substring(g).match(e);return t?(g+=t[0].length,t[0]):null}function r(){t(/^\s*/)}function n(){r();for(var e,n=0,i=[],o=[i],a=i;e=t(/^(\()/)||t(/^(\))/)||t(/^(\,)/)||t(vt);){if("("===e)o.push(a),a=[],o[o.length-1].push(a),n++;else if(")"===e){if(0===a.length)return null;if(!(a=o.pop()))return null;if(0===--n)break}else if(","===e)a=[],o[o.length-1].push(a);else{if(e.split(/\s/g).some(isNaN))return null;Array.prototype.push.apply(a,e.split(/\s/g).map(parseFloat))}r()}return 0!==n?null:i}function i(){for(var e,n,i=[];n=t(vt)||t(/^(\,)/);)","===n?(i.push(e),e=[]):n.split(/\s/g).some(isNaN)||(e||(e=[]),Array.prototype.push.apply(e,n.split(/\s/g).map(parseFloat))),r();return e?(i.push(e),i.length?i:null):null}function o(){if(!t(/^(point)/i))return null;if(r(),!t(/^(\()/))return null;var e=i();return e?(r(),t(/^(\))/)?{type:"Point",coordinates:e[0]}:null):null}function a(){if(!t(/^(multipoint)/i))return null;r();var e=d.substring(d.indexOf("(")+1,d.length-1).replace(/\(/g,"").replace(/\)/g,"");d="MULTIPOINT ("+e+")";var i=n();return i?(r(),{type:"MultiPoint",coordinates:i}):null}function u(){if(!t(/^(multilinestring)/i))return null;r();var e=n();return e?(r(),{type:"MultiLineString",coordinates:e}):null}function s(){if(!t(/^(linestring)/i))return null;if(r(),!t(/^(\()/))return null;var e=i();return e&&t(/^(\))/)?{type:"LineString",coordinates:e}:null}function l(){if(!t(/^(polygon)/i))return null;r();var e=n();return e?{type:"Polygon",coordinates:e}:null}function c(){if(!t(/^(multipolygon)/i))return null;r();var e=n();return e?{type:"MultiPolygon",coordinates:e}:null}function f(){var e,n=[];if(!t(/^(geometrycollection)/i))return null;if(r(),!t(/^(\()/))return null;for(;e=p();)n.push(e),r(),t(/^(\,)/),r();return t(/^(\))/)?{type:"GeometryCollection",geometries:n}:null}function p(){return o()||s()||l()||a()||u()||c()||f()}var h=e.split(";"),d=h.pop(),m=(h.shift()||"").split("=").pop(),g=0;return function(e){return e&&m.match(/\d+/)&&(e.crs={type:"name",properties:{name:"urn:ogc:def:crs:EPSG::"+m}}),e}(p())}function T(e){function t(e){return e.join(" ")}function r(e){return e.map(t).join(", ")}function n(e){return e.map(r).map(i).join(", ")}function i(e){return"("+e+")"}switch("Feature"===e.type&&(e=e.geometry),e.type){case"Point":return"POINT ("+t(e.coordinates)+")";case"LineString":return"LINESTRING ("+r(e.coordinates)+")";case"Polygon":return"POLYGON ("+n(e.coordinates)+")";case"MultiPoint":return"MULTIPOINT ("+r(e.coordinates)+")";case"MultiPolygon":return"MULTIPOLYGON ("+function(e){return e.map(n).map(i).join(", ")}(e.coordinates)+")";case"MultiLineString":return"MULTILINESTRING ("+n(e.coordinates)+")";case"GeometryCollection":return"GEOMETRYCOLLECTION ("+e.geometries.map(T).join(", ")+")";default:throw new Error("stringify requires a valid GeoJSON Feature or geometry object as input")}}function C(e,t){return t={exports:{}},e(t,t.exports),t.exports}function D(e,t){var r=t.id,n=t.bbox,i=null==t.properties?{}:t.properties,o=A(e,t);return null==r&&null==n?{type:"Feature",properties:i,geometry:o}:null==n?{type:"Feature",id:r,properties:i,geometry:o}:{type:"Feature",id:r,bbox:n,properties:i,geometry:o}}function A(e,t){function r(e,t){t.length&&t.pop();for(var r=l[e<0?~e:e],n=0,i=r.length;n<i;++n)t.push(s(r[n],n));e<0&&bt(t,i)}function n(e){return s(e)}function i(e){for(var t=[],n=0,i=e.length;n<i;++n)r(e[n],t);return t.length<2&&t.push(t[0]),t}function o(e){for(var t=i(e);t.length<4;)t.push(t[0]);return t}function a(e){return e.map(o)}function u(e){var t,r=e.type;switch(r){case"GeometryCollection":return{type:r,geometries:e.geometries.map(u)};case"Point":t=n(e.coordinates);break;case"MultiPoint":t=e.coordinates.map(n);break;case"LineString":t=i(e.arcs);break;case"MultiLineString":t=e.arcs.map(i);break;case"Polygon":t=a(e.arcs);break;case"MultiPolygon":t=e.arcs.map(a);break;default:return null}return{type:r,coordinates:t}}var s=wt(e.transform),l=e.arcs;return u(t)}function I(){}function R(e,t,r,n,i){function o(e){if(e>65535){e-=65536;var t=55296+(e>>10),r=56320+(1023&e);return String.fromCharCode(t,r)}return String.fromCharCode(e)}function a(e){var t=e.slice(1,-1);return t in r?r[t]:"#"===t.charAt(0)?o(parseInt(t.substr(1).replace("x","0x"))):(i.error("entity not found:"+e),e)}function u(t){if(t>m){var r=e.substring(m,t).replace(/&#?\w+;/g,a);p&&s(m),n.characters(r,0,t-m),m=t}}function s(t,r){for(;t>=c&&(r=f.exec(e));)l=r.index,c=l+r[0].length,p.lineNumber++;p.columnNumber=t-l+1}for(var l=0,c=0,f=/.*(?:\r\n?|\n)|.*$/g,p=n.locator,h=[{currentNSMap:t}],d={},m=0;;){try{var g=e.indexOf("<",m);if(g<0){if(!e.substr(m).match(/^\s*$/)){var v=n.doc,y=v.createTextNode(e.substr(m));v.appendChild(y),n.currentElement=y}return}switch(g>m&&u(g),e.charAt(g+1)){case"/":var N=e.indexOf(">",g+3),w=e.substring(g+2,N),b=h.pop();N<0?(w=e.substring(g+2).replace(/[\s<].*/,""),i.error("end tag name: "+w+" is not complete:"+b.tagName),N=g+1+w.length):w.match(/\s</)&&(w=w.replace(/[\s<].*/,""),i.error("end tag name: "+w+" maybe not complete"),N=g+1+w.length);var x=b.localNSMap,E=b.tagName==w;if(E||b.tagName&&b.tagName.toLowerCase()==w.toLowerCase()){if(n.endElement(b.uri,b.localName,w),x)for(var S in x)n.endPrefixMapping(S);E||i.fatalError("end tag name: "+w+" is not match the current start tagName:"+b.tagName)}else h.push(b);N++;break;case"?":p&&s(g),N=j(e,g,n);break;case"!":p&&s(g),N=P(e,g,n,i);break;default:p&&s(g);var T=new U,C=h[h.length-1].currentNSMap,N=F(e,g,T,C,a,i),D=T.length;if(!T.closed&&k(e,N,T.tagName,d)&&(T.closed=!0,r.nbsp||i.warning("unclosed xml attribute")),p&&D){for(var A=O(p,{}),I=0;I<D;I++){var R=T[I];s(R.offset),R.locator=O(p,{})}n.locator=A,_(T,n,C)&&h.push(T),n.locator=p}else _(T,n,C)&&h.push(T);"http://www.w3.org/1999/xhtml"!==T.uri||T.closed?N++:N=M(e,N,T.tagName,a,n)}}catch(e){i.error("element parse error: "+e),N=-1}N>m?m=N:u(Math.max(g,m)+1)}}function O(e,t){return t.lineNumber=e.lineNumber,t.columnNumber=e.columnNumber,t}function F(e,t,r,n,i,o){for(var a,u,s=++t,l=Dt;;){var c=e.charAt(s);switch(c){case"=":if(l===At)a=e.slice(t,s),l=Rt;else{if(l!==It)throw new Error("attribute equal must after attrName");l=Rt}break;case"'":case'"':if(l===Rt||l===At){if(l===At&&(o.warning('attribute value must after "="'),a=e.slice(t,s)),t=s+1,!((s=e.indexOf(c,t))>0))throw new Error("attribute value no end '"+c+"' match");u=e.slice(t,s).replace(/&#?\w+;/g,i),r.add(a,u,t-1),l=Ft}else{if(l!=Ot)throw new Error('attribute value must after "="');u=e.slice(t,s).replace(/&#?\w+;/g,i),r.add(a,u,t),o.warning('attribute "'+a+'" missed start quot('+c+")!!"),t=s+1,l=Ft}break;case"/":switch(l){case Dt:r.setTagName(e.slice(t,s));case Ft:case _t:case Mt:l=Mt,r.closed=!0;case Ot:case At:case It:break;default:throw new Error("attribute invalid close char('/')")}break;case"":return o.error("unexpected end of input"),l==Dt&&r.setTagName(e.slice(t,s)),s;case">":switch(l){case Dt:r.setTagName(e.slice(t,s));case Ft:case _t:case Mt:break;case Ot:case At:u=e.slice(t,s),"/"===u.slice(-1)&&(r.closed=!0,u=u.slice(0,-1));case It:l===It&&(u=a),l==Ot?(o.warning('attribute "'+u+'" missed quot(")!!'),r.add(a,u.replace(/&#?\w+;/g,i),t)):("http://www.w3.org/1999/xhtml"===n[""]&&u.match(/^(?:disabled|checked|selected)$/i)||o.warning('attribute "'+u+'" missed value!! "'+u+'" instead!!'),r.add(u,u,t));break;case Rt:throw new Error("attribute value missed!!")}return s;case"\x80":c=" ";default:if(c<=" ")switch(l){case Dt:r.setTagName(e.slice(t,s)),l=_t;break;case At:a=e.slice(t,s),l=It;break;case Ot:var u=e.slice(t,s).replace(/&#?\w+;/g,i);o.warning('attribute "'+u+'" missed quot(")!!'),r.add(a,u,t);case Ft:l=_t}else switch(l){case It:r.tagName;"http://www.w3.org/1999/xhtml"===n[""]&&a.match(/^(?:disabled|checked|selected)$/i)||o.warning('attribute "'+a+'" missed value!! "'+a+'" instead2!!'),r.add(a,a,t),t=s,l=At;break;case Ft:o.warning('attribute space is required"'+a+'"!!');case _t:l=At,t=s;break;case Rt:l=Ot,t=s;break;case Mt:throw new Error("elements closed character '/' and '>' must be connected to")}}s++}}function _(e,t,r){for(var n=e.tagName,i=null,o=e.length;o--;){var a=e[o],u=a.qName,s=a.value,l=u.indexOf(":");if(l>0)var c=a.prefix=u.slice(0,l),f=u.slice(l+1),p="xmlns"===c&&f;else f=u,c=null,p="xmlns"===u&&"";a.localName=f,!1!==p&&(null==i&&(i={},L(r,r={})),r[p]=i[p]=s,a.uri="http://www.w3.org/2000/xmlns/",t.startPrefixMapping(p,s))}for(var o=e.length;o--;){a=e[o];var c=a.prefix;c&&("xml"===c&&(a.uri="http://www.w3.org/XML/1998/namespace"),"xmlns"!==c&&(a.uri=r[c||""]))}var l=n.indexOf(":");l>0?(c=e.prefix=n.slice(0,l),f=e.localName=n.slice(l+1)):(c=null,f=e.localName=n);var h=e.uri=r[c||""];if(t.startElement(h,f,n,e),!e.closed)return e.currentNSMap=r,e.localNSMap=i,!0;if(t.endElement(h,f,n),i)for(c in i)t.endPrefixMapping(c)}function M(e,t,r,n,i){if(/^(?:script|textarea)$/i.test(r)){var o=e.indexOf("</"+r+">",t),a=e.substring(t+1,o);if(/[&<]/.test(a))return/^script$/i.test(r)?(i.characters(a,0,a.length),o):(a=a.replace(/&#?\w+;/g,n),i.characters(a,0,a.length),o)}return t+1}function k(e,t,r,n){var i=n[r];return null==i&&(i=e.lastIndexOf("</"+r+">"),i<t&&(i=e.lastIndexOf("</"+r)),n[r]=i),i<t}function L(e,t){for(var r in e)t[r]=e[r]}function P(e,t,r,n){switch(e.charAt(t+2)){case"-":if("-"===e.charAt(t+3)){var i=e.indexOf("--\x3e",t+4);return i>t?(r.comment(e,t+4,i-t-4),i+3):(n.error("Unclosed comment"),-1)}return-1;default:if("CDATA["==e.substr(t+3,6)){var i=e.indexOf("]]>",t+9);return r.startCDATA(),r.characters(e,t+9,i-t-9),r.endCDATA(),i+3}var o=$(e,t),a=o.length;if(a>1&&/!doctype/i.test(o[0][0])){var u=o[1][0],s=a>3&&/^public$/i.test(o[2][0])&&o[3][0],l=a>4&&o[4][0],c=o[a-1];return r.startDTD(u,s&&s.replace(/^(['"])(.*?)\1$/,"$2"),l&&l.replace(/^(['"])(.*?)\1$/,"$2")),r.endDTD(),c.index+c[0].length}}return-1}function j(e,t,r){var n=e.indexOf("?>",t);if(n){var i=e.substring(t,n).match(/^<\?(\S*)\s*([\s\S]*?)\s*$/);if(i){i[0].length;return r.processingInstruction(i[1],i[2]),n+2}return-1}return-1}function U(e){}function B(e,t){return ut(e,t),e}function $(e,t){var r,n=[],i=/'[^']+'|"[^"]+"|[^\s<>\/=]+=?|(\/?\s*>|<)/g;for(i.lastIndex=t,i.exec(e);r=i.exec(e);)if(n.push(r),r[1])return n}function G(e,t){for(var r in e)t[r]=e[r]}function z(e,t){var r=e.prototype;if(Object.create){var n=Object.create(t.prototype);ut(r,n)}if(!(r instanceof t)){var i=function(){};i.prototype=t.prototype,i=new i,G(r,i),e.prototype=r=i}r.constructor!=e&&("function"!=typeof e&&console.error("unknow Class:"+e),r.constructor=e)}function V(e,t){if(t instanceof Error)var r=t;else r=this,Error.call(this,Zt[e]),this.message=Zt[e],Error.captureStackTrace&&Error.captureStackTrace(this,V);return r.code=e,t&&(this.message=this.message+": "+t),r}function q(){}function H(e,t){this._node=e,this._refresh=t,X(this)}function X(e){var t=e._node._inc||e._node.ownerDocument._inc;if(e._inc!=t){var r=e._refresh(e._node);De(e,"length",r.length),G(r,e),e._inc=t}}function W(){}function Y(e,t){for(var r=e.length;r--;)if(e[r]===t)return r}function J(e,t,r,n){if(n?t[Y(t,n)]=r:t[t.length++]=r,e){r.ownerElement=e;var i=e.ownerDocument;i&&(n&&ie(i,e,n),ne(i,e,r))}}function Q(e,t,r){var n=Y(t,r);if(!(n>=0))throw V(er,new Error(e.tagName+"@"+r));for(var i=t.length-1;n<i;)t[n]=t[++n];if(t.length=i,e){var o=e.ownerDocument;o&&(ie(o,e,r),r.ownerElement=null)}}function Z(e){if(this._features={},e)for(var t in e)this._features=e[t]}function K(){}function ee(e){return"<"==e&&"&lt;"||">"==e&&"&gt;"||"&"==e&&"&amp;"||'"'==e&&"&quot;"||"&#"+e.charCodeAt()+";"}function te(e,t){if(t(e))return!0;if(e=e.firstChild)do{if(te(e,t))return!0}while(e=e.nextSibling)}function re(){}function ne(e,t,r){e&&e._inc++,"http://www.w3.org/2000/xmlns/"==r.namespaceURI&&(t._nsMap[r.prefix?r.localName:""]=r.value)}function ie(e,t,r,n){e&&e._inc++,"http://www.w3.org/2000/xmlns/"==r.namespaceURI&&delete t._nsMap[r.prefix?r.localName:""]}function oe(e,t,r){if(e&&e._inc){e._inc++;var n=t.childNodes;if(r)n[n.length++]=r;else{for(var i=t.firstChild,o=0;i;)n[o++]=i,i=i.nextSibling;n.length=o}}}function ae(e,t){var r=t.previousSibling,n=t.nextSibling;return r?r.nextSibling=n:e.firstChild=n,n?n.previousSibling=r:e.lastChild=r,oe(e.ownerDocument,e),t}function ue(e,t,r){var n=t.parentNode;if(n&&n.removeChild(t),t.nodeType===Yt){var i=t.firstChild;if(null==i)return t;var o=t.lastChild}else i=o=t;var a=r?r.previousSibling:e.lastChild;i.previousSibling=a,o.nextSibling=r,a?a.nextSibling=i:e.firstChild=i,null==r?e.lastChild=o:r.previousSibling=o;do{i.parentNode=e}while(i!==o&&(i=i.nextSibling));return oe(e.ownerDocument||e,e),t.nodeType==Yt&&(t.firstChild=t.lastChild=null),t}function se(e,t){var r=t.parentNode;if(r){var n=e.lastChild;r.removeChild(t);var n=e.lastChild}var n=e.lastChild;return t.parentNode=e,t.previousSibling=n,t.nextSibling=null,n?n.nextSibling=t:e.firstChild=t,e.lastChild=t,oe(e.ownerDocument,e,t),t}function le(){this._nsMap={}}function ce(){}function fe(){}function pe(){}function he(){}function de(){}function me(){}function ge(){}function ve(){}function ye(){}function Ne(){}function we(){}function be(){}function xe(e,t){var r=[],n=9==this.nodeType?this.documentElement:this,i=n.prefix,o=n.namespaceURI;if(o&&null==i){var i=n.lookupPrefix(o);if(null==i)var a=[{namespace:o,prefix:null}]}return Se(this,r,e,t,a),r.join("")}function Ee(e,t,r){var n=e.prefix||"",i=e.namespaceURI;if(!n&&!i)return!1;if("xml"===n&&"http://www.w3.org/XML/1998/namespace"===i||"http://www.w3.org/2000/xmlns/"==i)return!1;for(var o=r.length;o--;){var a=r[o];if(a.prefix==n)return a.namespace!=i}return!0}function Se(e,t,r,n,i){if(n){if(!(e=n(e)))return;if("string"==typeof e)return void t.push(e)}switch(e.nodeType){case Ut:i||(i=[]);var o=(i.length,e.attributes),a=o.length,u=e.firstChild,s=e.tagName;r=Pt===e.namespaceURI||r,t.push("<",s);for(var l=0;l<a;l++){var c=o.item(l);"xmlns"==c.prefix?i.push({prefix:c.localName,namespace:c.value}):"xmlns"==c.nodeName&&i.push({prefix:"",namespace:c.value})}for(var l=0;l<a;l++){var c=o.item(l);if(Ee(c,r,i)){var f=c.prefix||"",p=c.namespaceURI,h=f?" xmlns:"+f:" xmlns";t.push(h,'="',p,'"'),i.push({prefix:f,namespace:p})}Se(c,t,r,n,i)}if(Ee(e,r,i)){var f=e.prefix||"",p=e.namespaceURI,h=f?" xmlns:"+f:" xmlns";t.push(h,'="',p,'"'),i.push({prefix:f,namespace:p})}if(u||r&&!/^(?:meta|link|img|br|hr|input)$/i.test(s)){if(t.push(">"),r&&/^script$/i.test(s))for(;u;)u.data?t.push(u.data):Se(u,t,r,n,i),u=u.nextSibling;else for(;u;)Se(u,t,r,n,i),u=u.nextSibling;t.push("</",s,">")}else t.push("/>");return;case Xt:case Yt:for(var u=e.firstChild;u;)Se(u,t,r,n,i),u=u.nextSibling;return;case Bt:return t.push(" ",e.name,'="',e.value.replace(/[<&"]/g,ee),'"');case $t:return t.push(e.data.replace(/[<&]/g,ee));case Gt:return t.push("<![CDATA[",e.data,"]]>");case Ht:return t.push("\x3c!--",e.data,"--\x3e");case Wt:var d=e.publicId,m=e.systemId;if(t.push("<!DOCTYPE ",e.name),d)t.push(' PUBLIC "',d),m&&"."!=m&&t.push('" "',m),t.push('">');else if(m&&"."!=m)t.push(' SYSTEM "',m,'">');else{var g=e.internalSubset;g&&t.push(" [",g,"]"),t.push(">")}return;case qt:return t.push("<?",e.target," ",e.data,"?>");case zt:return t.push("&",e.nodeName,";");default:t.push("??",e.nodeName)}}function Te(e,t,r){var n;switch(t.nodeType){case Ut:n=t.cloneNode(!1),n.ownerDocument=e;case Yt:break;case Bt:r=!0}if(n||(n=t.cloneNode(!1)),n.ownerDocument=e,n.parentNode=null,r)for(var i=t.firstChild;i;)n.appendChild(Te(e,i,r)),i=i.nextSibling;return n}function Ce(e,t,r){var n=new t.constructor;for(var i in t){var o=t[i];"object"!=(void 0===o?"undefined":at(o))&&o!=n[i]&&(n[i]=o)}switch(t.childNodes&&(n.childNodes=new q),n.ownerDocument=e,n.nodeType){case Ut:var a=t.attributes,u=n.attributes=new W,s=a.length;u._ownerElement=n;for(var l=0;l<s;l++)n.setAttributeNode(Ce(e,a.item(l),!0));break;case Bt:r=!0}if(r)for(var c=t.firstChild;c;)n.appendChild(Ce(e,c,r)),c=c.nextSibling;return n}function De(e,t,r){e[t]=r}function Ae(e,r){return t.Ajax.get(e,function(e,t){if(e)return void r(e);var n=JSON.parse(t);r(null,n)}),this}function Ie(e,r){return t.Ajax.get(e,function(e,t){if(e)return void r(e);var n=ke(t);r(null,n)}),this}function Re(e,r,n){return t.Ajax.get(e,function(e,i){if(e)return void n(e);t.Util.isFunction(r)&&(n=r,r={}),Le(i,r,function(e,t){if(e)return void n(e);n(null,t)})}),this}function Oe(e,r){return t.Ajax.get(e,function(e,t){if(e)return void r(e);var n=Pe(t);r(null,n)}),this}function Fe(e,r){return t.Ajax.get(e,function(e,t){if(e)return void r(e);var n=je(t);r(null,n)}),this}function _e(e,r){return t.Ajax.get(e,function(e,t){if(e)return void r(e);var n=Ue(t);r(null,n)}),this}function Me(e,r,n){return t.Ajax.get(e,function(e,i){if(e)return void n(e);t.Util.isFunction(r)&&(n=r,r={});var o=Be(i,r);n(null,o)}),this}function ke(e){var r=[],n="string"==typeof e?JSON.parse(e):e;for(var i in n.objects){var o=xt(n,n.objects[i]);o.features?t.Util.pushIn(r,o.features):r.push(o)}return r}function Le(e,t,r){pt.csv2geojson(e,t||{},function(e,t){return r(e,t)})}function Pe(e){var t=$e(e);if(!t)throw new Error("Could not parse gpx");return ur.gpx(t)}function je(e){var t=$e(e);if(!t)throw new Error("Could not parse KML");return ur.kml(t)}function Ue(e){return ht(e)}function Be(e,t){t=t||{};for(var r=yt.decode(e,t.precision),n={type:"LineString",coordinates:[]},i=0;i<r.length;i++)n.coordinates[i]=[r[i][1],r[i][0]];return n}function $e(e){return"string"==typeof e?(new DOMParser).parseFromString(e,"text/xml"):e}var Ge=function(e){function t(e,t){var i,a,u=o(e,function(e,o){if(i)return i(e,o-1);a=e,i=t?n(e,t):r(e)});return u.columns=a,u}function o(e,t){function r(){if(l>=s)return a;if(i)return i=!1,o;var t,r=l;if(34===e.charCodeAt(r)){for(var n=r;n++<s;)if(34===e.charCodeAt(n)){if(34!==e.charCodeAt(n+1))break;++n}return l=n+2,t=e.charCodeAt(n+1),13===t?(i=!0,10===e.charCodeAt(n+2)&&++l):10===t&&(i=!0),e.slice(r+1,n).replace(/""/g,'"')}for(;l<s;){var u=1;if(10===(t=e.charCodeAt(l++)))i=!0;else if(13===t)i=!0,10===e.charCodeAt(l)&&(++l,++u);else if(t!==f)continue;return e.slice(r,l-u)}return e.slice(r)}for(var n,i,o={},a={},u=[],s=e.length,l=0,c=0;(n=r())!==a;){for(var p=[];n!==o&&n!==a;)p.push(n),n=r();t&&null==(p=t(p,c++))||u.push(p)}return u}function a(t,r){return null==r&&(r=i(t)),[r.map(l).join(e)].concat(t.map(function(t){return r.map(function(e){return l(t[e])}).join(e)})).join("\n")}function u(e){return e.map(s).join("\n")}function s(t){return t.map(l).join(e)}function l(e){return null==e?"":c.test(e+="")?'"'+e.replace(/\"/g,'""')+'"':e}var c=new RegExp('["'+e+"\n]"),f=e.charCodeAt(0);return{parse:t,parseRows:o,format:a,formatRows:u}},ze=Ge(","),Ve=ze.parse,qe=ze.parseRows,He=ze.format,Xe=ze.formatRows,We=Ge("\t"),Ye=We.parse,Je=We.parseRows,Qe=We.format,Ze=We.formatRows,Ke=Object.freeze({dsvFormat:Ge,csvParse:Ve,csvParseRows:qe,csvFormat:He,csvFormatRows:Xe,tsvParse:Ye,tsvParseRows:Je,tsvFormat:Qe,tsvFormatRows:Ze}),et=o,tt=c,rt=u,nt=a,it=s;et.pair=tt,et.format=rt,et.formatPair=nt,et.coordToDMS=it;var ot=Ke&&void 0||Ke,at="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ut=function(e,t){for(var r=Object.getOwnPropertyNames(t),n=0;n<r.length;n++){var i=r[n],o=Object.getOwnPropertyDescriptor(t,i);o&&o.configurable&&void 0===e[i]&&Object.defineProperty(e,i,o)}return e},st=ot,lt=et,ct=/(Lat)(itude)?/gi,ft=/(L)(on|ng)(gitude)?/i,pt={isLon:g,isLat:m,guessLatHeader:h,guessLonHeader:d,csv:st.csvParse,tsv:st.tsvParse,dsv:st,auto:w,csv2geojson:b,toLine:x,toPolygon:E},ht=S,dt=S,mt=T,gt=/[-+]?([0-9]*\.[0-9]+|[0-9]+)([eE][-+]?[0-9]+)?/,vt=new RegExp("^"+gt.source+"(\\s"+gt.source+"){1,}");ht.parse=dt,ht.stringify=mt;var yt=C(function(e){function t(e){return Math.floor(Math.abs(e)+.5)*Math.sign(e)}function r(e,r,n){e=t(e*n),r=t(r*n);var i=e-r;i<<=1,e-r<0&&(i=~i);for(var o="";i>=32;)o+=String.fromCharCode(63+(32|31&i)),i>>=5;return o+=String.fromCharCode(i+63)}function n(e){for(var t=[],r=0;r<e.length;r++)t.push(e[r].slice().reverse());return t}var i={};i.decode=function(e,t){for(var r,n,i=0,o=0,a=0,u=[],s=0,l=0,c=null,f=Math.pow(10,t||5);i<e.length;){c=null,s=0,l=0;do{c=e.charCodeAt(i++)-63,l|=(31&c)<<s,s+=5}while(c>=32);r=1&l?~(l>>1):l>>1,s=l=0;do{c=e.charCodeAt(i++)-63,l|=(31&c)<<s,s+=5}while(c>=32);n=1&l?~(l>>1):l>>1,o+=r,a+=n,u.push([o/f,a/f])}return u},i.encode=function(e,t){if(!e.length)return"";for(var n=Math.pow(10,t||5),i=r(e[0][0],0,n)+r(e[0][1],0,n),o=1;o<e.length;o++){var a=e[o],u=e[o-1];i+=r(a[0],u[0],n),i+=r(a[1],u[1],n)}return i},i.fromGeoJSON=function(e,t){if(e&&"Feature"===e.type&&(e=e.geometry),!e||"LineString"!==e.type)throw new Error("Input must be a GeoJSON LineString");return i.encode(n(e.coordinates),t)},i.toGeoJSON=function(e,t){return{type:"LineString",coordinates:n(i.decode(e,t))}},e.exports&&(e.exports=i)}),Nt=function(e){return e},wt=function(e){if(null==e)return Nt;var t,r,n=e.scale[0],i=e.scale[1],o=e.translate[0],a=e.translate[1];return function(e,u){u||(t=r=0);var s=2,l=e.length,c=new Array(l);for(c[0]=(t+=e[0])*n+o,c[1]=(r+=e[1])*i+a;s<l;)c[s]=e[s],++s;return c}},bt=function(e,t){for(var r,n=e.length,i=n-t;i<--n;)r=e[i],e[i++]=e[n],e[n]=r},xt=function(e,t){return"GeometryCollection"===t.type?{type:"FeatureCollection",features:t.geometries.map(function(t){return D(e,t)})}:D(e,t)},Et=new ArrayBuffer(16),St=(new Float64Array(Et),new Uint32Array(Et),/[A-Z_a-z\xC0-\xD6\xD8-\xF6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/),Tt=new RegExp("[\\-\\.0-9"+St.source.slice(1,-1)+"\\u00B7\\u0300-\\u036F\\u203F-\\u2040]"),Ct=new RegExp("^"+St.source+Tt.source+"*(?::"+St.source+Tt.source+"*)?$"),Dt=0,At=1,It=2,Rt=3,Ot=4,Ft=5,_t=6,Mt=7;I.prototype={parse:function(e,t,r){var n=this.domBuilder;n.startDocument(),L(t,t={}),R(e,t,r,n,this.errorHandler),n.endDocument()}},U.prototype={setTagName:function(e){if(!Ct.test(e))throw new Error("invalid tagName:"+e);this.tagName=e},add:function(e,t,r){if(!Ct.test(e))throw new Error("invalid attribute:"+e);this[this.length++]={qName:e,value:t,offset:r}},length:0,getLocalName:function(e){return this[e].localName},getLocator:function(e){return this[e].locator},getQName:function(e){return this[e].qName},getURI:function(e){return this[e].uri},getValue:function(e){return this[e].value}},B({},B.prototype)instanceof B||(B=function(e,t){function r(){}r.prototype=t,r=new r;for(t in e)r[t]=e[t];return r});var kt=I,Lt={XMLReader:kt},Pt="http://www.w3.org/1999/xhtml",jt={},Ut=jt.ELEMENT_NODE=1,Bt=jt.ATTRIBUTE_NODE=2,$t=jt.TEXT_NODE=3,Gt=jt.CDATA_SECTION_NODE=4,zt=jt.ENTITY_REFERENCE_NODE=5,Vt=jt.ENTITY_NODE=6,qt=jt.PROCESSING_INSTRUCTION_NODE=7,Ht=jt.COMMENT_NODE=8,Xt=jt.DOCUMENT_NODE=9,Wt=jt.DOCUMENT_TYPE_NODE=10,Yt=jt.DOCUMENT_FRAGMENT_NODE=11,Jt=jt.NOTATION_NODE=12,Qt={},Zt={},Kt=(Qt.INDEX_SIZE_ERR=(Zt[1]="Index size error",1),Qt.DOMSTRING_SIZE_ERR=(Zt[2]="DOMString size error",2),Qt.HIERARCHY_REQUEST_ERR=(Zt[3]="Hierarchy request error",3)),er=(Qt.WRONG_DOCUMENT_ERR=(Zt[4]="Wrong document",4),Qt.INVALID_CHARACTER_ERR=(Zt[5]="Invalid character",5),Qt.NO_DATA_ALLOWED_ERR=(Zt[6]="No data allowed",6),Qt.NO_MODIFICATION_ALLOWED_ERR=(Zt[7]="No modification allowed",7),Qt.NOT_FOUND_ERR=(Zt[8]="Not found",8)),tr=(Qt.NOT_SUPPORTED_ERR=(Zt[9]="Not supported",9),Qt.INUSE_ATTRIBUTE_ERR=(Zt[10]="Attribute in use",10));Qt.INVALID_STATE_ERR=(Zt[11]="Invalid state",11),Qt.SYNTAX_ERR=(Zt[12]="Syntax error",12),Qt.INVALID_MODIFICATION_ERR=(Zt[13]="Invalid modification",13),Qt.NAMESPACE_ERR=(Zt[14]="Invalid namespace",14),Qt.INVALID_ACCESS_ERR=(Zt[15]="Invalid access",15);V.prototype=Error.prototype,G(Qt,V),q.prototype={length:0,item:function(e){return this[e]||null},toString:function(e,t){for(var r=[],n=0;n<this.length;n++)Se(this[n],r,e,t);return r.join("")}},H.prototype.item=function(e){return X(this),this[e]},z(H,q),W.prototype={length:0,item:q.prototype.item,getNamedItem:function(e){for(var t=this.length;t--;){var r=this[t];if(r.nodeName==e)return r}},setNamedItem:function(e){var t=e.ownerElement;if(t&&t!=this._ownerElement)throw new V(tr);var r=this.getNamedItem(e.nodeName);return J(this._ownerElement,this,e,r),r},setNamedItemNS:function(e){var t,r=e.ownerElement;if(r&&r!=this._ownerElement)throw new V(tr);return t=this.getNamedItemNS(e.namespaceURI,e.localName),J(this._ownerElement,this,e,t),t},removeNamedItem:function(e){var t=this.getNamedItem(e);return Q(this._ownerElement,this,t),t},removeNamedItemNS:function(e,t){var r=this.getNamedItemNS(e,t);return Q(this._ownerElement,this,r),r},getNamedItemNS:function(e,t){for(var r=this.length;r--;){var n=this[r];if(n.localName==t&&n.namespaceURI==e)return n}return null}},Z.prototype={hasFeature:function(e,t){var r=this._features[e.toLowerCase()];return!(!r||t&&!(t in r))},createDocument:function(e,t,r){var n=new re;if(n.implementation=this,n.childNodes=new q,n.doctype=r,r&&n.appendChild(r),t){var i=n.createElementNS(e,t);n.appendChild(i)}return n},createDocumentType:function(e,t,r){var n=new me;return n.name=e,n.nodeName=e,n.publicId=t,n.systemId=r,n}},K.prototype={firstChild:null,lastChild:null,previousSibling:null,nextSibling:null,attributes:null,parentNode:null,childNodes:null,ownerDocument:null,nodeValue:null,namespaceURI:null,prefix:null,localName:null,insertBefore:function(e,t){return ue(this,e,t)},replaceChild:function(e,t){this.insertBefore(e,t),t&&this.removeChild(t)},removeChild:function(e){return ae(this,e)},appendChild:function(e){return this.insertBefore(e,null)},hasChildNodes:function(){return null!=this.firstChild},cloneNode:function(e){return Ce(this.ownerDocument||this,this,e)},normalize:function(){for(var e=this.firstChild;e;){var t=e.nextSibling;t&&t.nodeType==$t&&e.nodeType==$t?(this.removeChild(t),e.appendData(t.data)):(e.normalize(),e=t)}},isSupported:function(e,t){return this.ownerDocument.implementation.hasFeature(e,t)},hasAttributes:function(){return this.attributes.length>0},lookupPrefix:function(e){for(var t=this;t;){var r=t._nsMap;if(r)for(var n in r)if(r[n]==e)return n;t=t.nodeType==Bt?t.ownerDocument:t.parentNode}return null},lookupNamespaceURI:function(e){for(var t=this;t;){var r=t._nsMap;if(r&&e in r)return r[e];t=t.nodeType==Bt?t.ownerDocument:t.parentNode}return null},isDefaultNamespace:function(e){return null==this.lookupPrefix(e)}},G(jt,K),G(jt,K.prototype),re.prototype={nodeName:"#document",nodeType:Xt,doctype:null,documentElement:null,_inc:1,insertBefore:function(e,t){if(e.nodeType==Yt){for(var r=e.firstChild;r;){var n=r.nextSibling;this.insertBefore(r,t),r=n}return e}return null==this.documentElement&&e.nodeType==Ut&&(this.documentElement=e),ue(this,e,t),e.ownerDocument=this,e},removeChild:function(e){return this.documentElement==e&&(this.documentElement=null),ae(this,e)},importNode:function(e,t){return Te(this,e,t)},getElementById:function(e){var t=null;return te(this.documentElement,function(r){if(r.nodeType==Ut&&r.getAttribute("id")==e)return t=r,!0}),t},createElement:function(e){var t=new le;return t.ownerDocument=this,t.nodeName=e,t.tagName=e,t.childNodes=new q,(t.attributes=new W)._ownerElement=t,t},createDocumentFragment:function(){var e=new Ne;return e.ownerDocument=this,e.childNodes=new q,e},createTextNode:function(e){var t=new pe;return t.ownerDocument=this,t.appendData(e),t},createComment:function(e){var t=new he;return t.ownerDocument=this,t.appendData(e),t},createCDATASection:function(e){var t=new de;return t.ownerDocument=this,t.appendData(e),t},createProcessingInstruction:function(e,t){var r=new we;return r.ownerDocument=this,r.tagName=r.target=e,r.nodeValue=r.data=t,r},createAttribute:function(e){var t=new ce;return t.ownerDocument=this,t.name=e,t.nodeName=e,t.localName=e,t.specified=!0,t},createEntityReference:function(e){var t=new ye;return t.ownerDocument=this,t.nodeName=e,t},createElementNS:function(e,t){
var r=new le,n=t.split(":"),i=r.attributes=new W;return r.childNodes=new q,r.ownerDocument=this,r.nodeName=t,r.tagName=t,r.namespaceURI=e,2==n.length?(r.prefix=n[0],r.localName=n[1]):r.localName=t,i._ownerElement=r,r},createAttributeNS:function(e,t){var r=new ce,n=t.split(":");return r.ownerDocument=this,r.nodeName=t,r.name=t,r.namespaceURI=e,r.specified=!0,2==n.length?(r.prefix=n[0],r.localName=n[1]):r.localName=t,r}},z(re,K),le.prototype={nodeType:Ut,hasAttribute:function(e){return null!=this.getAttributeNode(e)},getAttribute:function(e){var t=this.getAttributeNode(e);return t&&t.value||""},getAttributeNode:function(e){return this.attributes.getNamedItem(e)},setAttribute:function(e,t){var r=this.ownerDocument.createAttribute(e);r.value=r.nodeValue=""+t,this.setAttributeNode(r)},removeAttribute:function(e){var t=this.getAttributeNode(e);t&&this.removeAttributeNode(t)},appendChild:function(e){return e.nodeType===Yt?this.insertBefore(e,null):se(this,e)},setAttributeNode:function(e){return this.attributes.setNamedItem(e)},setAttributeNodeNS:function(e){return this.attributes.setNamedItemNS(e)},removeAttributeNode:function(e){return this.attributes.removeNamedItem(e.nodeName)},removeAttributeNS:function(e,t){var r=this.getAttributeNodeNS(e,t);r&&this.removeAttributeNode(r)},hasAttributeNS:function(e,t){return null!=this.getAttributeNodeNS(e,t)},getAttributeNS:function(e,t){var r=this.getAttributeNodeNS(e,t);return r&&r.value||""},setAttributeNS:function(e,t,r){var n=this.ownerDocument.createAttributeNS(e,t);n.value=n.nodeValue=""+r,this.setAttributeNode(n)},getAttributeNodeNS:function(e,t){return this.attributes.getNamedItemNS(e,t)},getElementsByTagName:function(e){return new H(this,function(t){var r=[];return te(t,function(n){n===t||n.nodeType!=Ut||"*"!==e&&n.tagName!=e||r.push(n)}),r})},getElementsByTagNameNS:function(e,t){return new H(this,function(r){var n=[];return te(r,function(i){i===r||i.nodeType!==Ut||"*"!==e&&i.namespaceURI!==e||"*"!==t&&i.localName!=t||n.push(i)}),n})}},re.prototype.getElementsByTagName=le.prototype.getElementsByTagName,re.prototype.getElementsByTagNameNS=le.prototype.getElementsByTagNameNS,z(le,K),ce.prototype.nodeType=Bt,z(ce,K),fe.prototype={data:"",substringData:function(e,t){return this.data.substring(e,e+t)},appendData:function(e){e=this.data+e,this.nodeValue=this.data=e,this.length=e.length},insertData:function(e,t){this.replaceData(e,0,t)},appendChild:function(e){throw new Error(Zt[Kt])},deleteData:function(e,t){this.replaceData(e,t,"")},replaceData:function(e,t,r){r=this.data.substring(0,e)+r+this.data.substring(e+t),this.nodeValue=this.data=r,this.length=r.length}},z(fe,K),pe.prototype={nodeName:"#text",nodeType:$t,splitText:function(e){var t=this.data,r=t.substring(e);t=t.substring(0,e),this.data=this.nodeValue=t,this.length=t.length;var n=this.ownerDocument.createTextNode(r);return this.parentNode&&this.parentNode.insertBefore(n,this.nextSibling),n}},z(pe,fe),he.prototype={nodeName:"#comment",nodeType:Ht},z(he,fe),de.prototype={nodeName:"#cdata-section",nodeType:Gt},z(de,fe),me.prototype.nodeType=Wt,z(me,K),ge.prototype.nodeType=Jt,z(ge,K),ve.prototype.nodeType=Vt,z(ve,K),ye.prototype.nodeType=zt,z(ye,K),Ne.prototype.nodeName="#document-fragment",Ne.prototype.nodeType=Yt,z(Ne,K),we.prototype.nodeType=qt,z(we,K),be.prototype.serializeToString=function(e,t,r){return xe.call(e,t,r)},K.prototype.toString=xe;try{if(Object.defineProperty){var rr=function e(t){switch(t.nodeType){case Ut:case Yt:var r=[];for(t=t.firstChild;t;)7!==t.nodeType&&8!==t.nodeType&&r.push(e(t)),t=t.nextSibling;return r.join("");default:return t.nodeValue}};Object.defineProperty(H.prototype,"length",{get:function(){return X(this),this.$$length}}),Object.defineProperty(K.prototype,"textContent",{get:function(){return rr(this)},set:function(e){switch(this.nodeType){case Ut:case Yt:for(;this.firstChild;)this.removeChild(this.firstChild);(e||String(e))&&this.appendChild(this.ownerDocument.createTextNode(e));break;default:this.data=e,this.value=e,this.nodeValue=e}}}),De=function(e,t,r){e["$$"+t]=r}}}catch(e){}var nr=Z,ir=be,or={DOMImplementation:nr,XMLSerializer:ir},ar=C(function(e,t){function r(e){this.options=e||{locator:{}}}function n(e,t,r){function n(t){var n=e[t];!n&&u&&(n=2==e.length?function(r){e(t,r)}:e),o[t]=n&&function(e){n("[xmldom "+t+"]\t"+e+a(r))}||function(){}}if(!e){if(t instanceof i)return t;e=t}var o={},u=e instanceof Function;return r=r||{},n("warning"),n("error"),n("fatalError"),o}function i(){this.cdata=!1}function o(e,t){t.lineNumber=e.lineNumber,t.columnNumber=e.columnNumber}function a(e){if(e)return"\n@"+(e.systemId||"")+"#[line:"+e.lineNumber+",col:"+e.columnNumber+"]"}function u(e,t,r){return"string"==typeof e?e.substr(t,r):e.length>=t+r||t?new java.lang.String(e,t,r)+"":e}function s(e,t){e.currentElement?e.currentElement.appendChild(t):e.doc.appendChild(t)}r.prototype.parseFromString=function(e,t){var r=this.options,o=new l,a=r.domBuilder||new i,u=r.errorHandler,s=r.locator,c=r.xmlns||{},f={lt:"<",gt:">",amp:"&",quot:'"',apos:"'"};return s&&a.setDocumentLocator(s),o.errorHandler=n(u,a,s),o.domBuilder=r.domBuilder||a,/\/x?html?$/.test(t)&&(f.nbsp="\xa0",f.copy="\xa9",c[""]="http://www.w3.org/1999/xhtml"),c.xml=c.xml||"http://www.w3.org/XML/1998/namespace",e?o.parse(e,c,f):o.errorHandler.error("invalid doc source"),a.doc},i.prototype={startDocument:function(){this.doc=(new c).createDocument(null,null,null),this.locator&&(this.doc.documentURI=this.locator.systemId)},startElement:function(e,t,r,n){var i=this.doc,a=i.createElementNS(e,r||t),u=n.length;s(this,a),this.currentElement=a,this.locator&&o(this.locator,a);for(var l=0;l<u;l++){var e=n.getURI(l),c=n.getValue(l),r=n.getQName(l),f=i.createAttributeNS(e,r);this.locator&&o(n.getLocator(l),f),f.value=f.nodeValue=c,a.setAttributeNode(f)}},endElement:function(e,t,r){var n=this.currentElement;n.tagName;this.currentElement=n.parentNode},startPrefixMapping:function(e,t){},endPrefixMapping:function(e){},processingInstruction:function(e,t){var r=this.doc.createProcessingInstruction(e,t);this.locator&&o(this.locator,r),s(this,r)},ignorableWhitespace:function(e,t,r){},characters:function(e,t,r){if(e=u.apply(this,arguments)){if(this.cdata)var n=this.doc.createCDATASection(e);else var n=this.doc.createTextNode(e);this.currentElement?this.currentElement.appendChild(n):/^\s*$/.test(e)&&this.doc.appendChild(n),this.locator&&o(this.locator,n)}},skippedEntity:function(e){},endDocument:function(){this.doc.normalize()},setDocumentLocator:function(e){(this.locator=e)&&(e.lineNumber=0)},comment:function(e,t,r){e=u.apply(this,arguments);var n=this.doc.createComment(e);this.locator&&o(this.locator,n),s(this,n)},startCDATA:function(){this.cdata=!0},endCDATA:function(){this.cdata=!1},startDTD:function(e,t,r){var n=this.doc.implementation;if(n&&n.createDocumentType){var i=n.createDocumentType(e,t,r);this.locator&&o(this.locator,i),s(this,i)}},warning:function(e){console.warn("[xmldom warning]\t"+e,a(this.locator))},error:function(e){console.error("[xmldom error]\t"+e,a(this.locator))},fatalError:function(e){throw console.error("[xmldom fatalError]\t"+e,a(this.locator)),e}},"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl".replace(/\w+/g,function(e){i.prototype[e]=function(){return null}});var l=Lt.XMLReader,c=t.DOMImplementation=or.DOMImplementation;t.XMLSerializer=or.XMLSerializer,t.DOMParser=r}),ur=C(function(e,t){var r=function(){function e(e){if(!e||!e.length)return 0;for(var t=0,r=0;t<e.length;t++)r=(r<<5)-r+e.charCodeAt(t)|0;return r}function t(e,t){return e.getElementsByTagName(t)}function r(e,t){return e.getAttribute(t)}function n(e,t){return parseFloat(r(e,t))}function i(e,r){var n=t(e,r);return n.length?n[0]:null}function o(e){return e.normalize&&e.normalize(),e}function a(e){for(var t=0,r=[];t<e.length;t++)r[t]=parseFloat(e[t]);return r}function u(e){return e&&o(e),e&&e.textContent||""}function s(e,t){var r,n,o={};for(n=0;n<t.length;n++)(r=i(e,t[n]))&&(o[t[n]]=u(r));return o}function l(e,t){for(var r in t)e[r]=t[r]}function c(e){return a(e.replace(g,"").split(","))}function f(e){for(var t=e.replace(v,"").split(y),r=[],n=0;n<t.length;n++)r.push(c(t[n]));return r}function p(e){var t,r=[n(e,"lon"),n(e,"lat")],o=i(e,"ele"),a=i(e,"gpxtpx:hr")||i(e,"hr"),s=i(e,"time");return o&&(t=parseFloat(u(o)),isNaN(t)||r.push(t)),{coordinates:r,time:s?u(s):null,heartRate:a?parseFloat(u(a)):null}}function h(){return{type:"FeatureCollection",features:[]}}function d(e){return void 0!==e.xml?e.xml:m.serializeToString(e)}var m,g=/\s*/g,v=/^\s*|\s*$/g,y=/\s+/;return"undefined"!=typeof XMLSerializer?m=new XMLSerializer:"object"!==("undefined"==typeof process?"undefined":at(process))||process.browser||(m=new ar.XMLSerializer),{kml:function(n){function o(e){var t,r;return e=e||"","#"===e.substr(0,1)&&(e=e.substr(1)),6!==e.length&&3!==e.length||(t=e),8===e.length&&(r=parseInt(e.substr(0,2),16)/255,t="#"+e.substr(6,2)+e.substr(4,2)+e.substr(2,2)),[t,isNaN(r)?void 0:r]}function s(e){return a(e.split(" "))}function l(e){var r=t(e,"coord","gx"),n=[],i=[];0===r.length&&(r=t(e,"gx:coord"));for(var o=0;o<r.length;o++)n.push(s(u(r[o])));for(var a=t(e,"when"),l=0;l<a.length;l++)i.push(u(a[l]));return{coords:n,times:i}}function p(e){var r,n,o,a,s,h=[],d=[];if(i(e,"MultiGeometry"))return p(i(e,"MultiGeometry"));if(i(e,"MultiTrack"))return p(i(e,"MultiTrack"));if(i(e,"gx:MultiTrack"))return p(i(e,"gx:MultiTrack"));for(o=0;o<N.length;o++)if(n=t(e,N[o]))for(a=0;a<n.length;a++)if(r=n[a],"Point"===N[o])h.push({type:"Point",coordinates:c(u(i(r,"coordinates")))});else if("LineString"===N[o])h.push({type:"LineString",coordinates:f(u(i(r,"coordinates")))});else if("Polygon"===N[o]){var m=t(r,"LinearRing"),g=[];for(s=0;s<m.length;s++)g.push(f(u(i(m[s],"coordinates"))));h.push({type:"Polygon",coordinates:g})}else if("Track"===N[o]||"gx:Track"===N[o]){var v=l(r);h.push({type:"LineString",coordinates:v.coords}),v.times.length&&d.push(v.times)}return{geoms:h,coordTimes:d}}for(var m=h(),g={},v={},y={},N=["Polygon","LineString","Point","Track","gx:Track"],w=t(n,"Placemark"),b=t(n,"Style"),x=t(n,"StyleMap"),E=0;E<b.length;E++){var S=e(d(b[E])).toString(16);g["#"+r(b[E],"id")]=S,v[S]=b[E]}for(var T=0;T<x.length;T++){g["#"+r(x[T],"id")]=e(d(x[T])).toString(16);for(var C=t(x[T],"Pair"),D={},A=0;A<C.length;A++)D[u(i(C[A],"key"))]=u(i(C[A],"styleUrl"));y["#"+r(x[T],"id")]=D}for(var I=0;I<w.length;I++)m.features=m.features.concat(function(e){var n,a=p(e),s={},l=u(i(e,"name")),c=u(i(e,"address")),f=u(i(e,"styleUrl")),h=u(i(e,"description")),d=i(e,"TimeSpan"),m=i(e,"TimeStamp"),N=i(e,"ExtendedData"),w=i(e,"LineStyle"),b=i(e,"PolyStyle"),x=i(e,"visibility");if(!a.geoms.length)return[];if(l&&(s.name=l),c&&(s.address=c),f){"#"!==f[0]&&(f="#"+f),s.styleUrl=f,g[f]&&(s.styleHash=g[f]),y[f]&&(s.styleMapHash=y[f],s.styleHash=g[y[f].normal]);var E=v[s.styleHash];E&&(w||(w=i(E,"LineStyle")),b||(b=i(E,"PolyStyle")))}if(h&&(s.description=h),d){var S=u(i(d,"begin")),T=u(i(d,"end"));s.timespan={begin:S,end:T}}if(m&&(s.timestamp=u(i(m,"when"))),w){var C=o(u(i(w,"color"))),D=C[0],A=C[1],I=parseFloat(u(i(w,"width")));D&&(s.stroke=D),isNaN(A)||(s["stroke-opacity"]=A),isNaN(I)||(s["stroke-width"]=I)}if(b){var R=o(u(i(b,"color"))),O=R[0],F=R[1],_=u(i(b,"fill")),M=u(i(b,"outline"));O&&(s.fill=O),isNaN(F)||(s["fill-opacity"]=F),_&&(s["fill-opacity"]="1"===_?s["fill-opacity"]||1:0),M&&(s["stroke-opacity"]="1"===M?s["stroke-opacity"]||1:0)}if(N){var k=t(N,"Data"),L=t(N,"SimpleData");for(n=0;n<k.length;n++)s[k[n].getAttribute("name")]=u(i(k[n],"value"));for(n=0;n<L.length;n++)s[L[n].getAttribute("name")]=u(L[n])}x&&(s.visibility=u(x)),a.coordTimes.length&&(s.coordTimes=1===a.coordTimes.length?a.coordTimes[0]:a.coordTimes);var P={type:"Feature",geometry:1===a.geoms.length?a.geoms[0]:{type:"GeometryCollection",geometries:a.geoms},properties:s};return r(e,"id")&&(P.id=r(e,"id")),[P]}(w[I]));return m},gpx:function(e){function n(e,r){var n=t(e,r),i=[],o=[],a=[],u=n.length;if(u<2)return{};for(var s=0;s<u;s++){var l=p(n[s]);i.push(l.coordinates),l.time&&o.push(l.time),l.heartRate&&a.push(l.heartRate)}return{line:i,times:o,heartRates:a}}function o(e){var t={};if(e){var r=i(e,"line");if(r){var n=u(i(r,"color")),o=parseFloat(u(i(r,"opacity"))),a=parseFloat(u(i(r,"width")));n&&(t.stroke=n),isNaN(o)||(t["stroke-opacity"]=o),isNaN(a)||(t["stroke-width"]=96*a/25.4)}}return t}function a(e){var n=s(e,["name","cmt","desc","type","time","keywords"]),i=t(e,"link");i.length&&(n.links=[]);for(var o,a=0;a<i.length;a++)o={href:r(i[a],"href")},l(o,s(i[a],["text","type"])),n.links.push(o);return n}var c,f,d=t(e,"trk"),m=t(e,"rte"),g=t(e,"wpt"),v=h();for(c=0;c<d.length;c++)(f=function(e){for(var r,u=t(e,"trkseg"),s=[],c=[],f=[],p=0;p<u.length;p++)(r=n(u[p],"trkpt"))&&(r.line&&s.push(r.line),r.times&&r.times.length&&c.push(r.times),r.heartRates&&r.heartRates.length&&f.push(r.heartRates));if(0!==s.length){var h=a(e);return l(h,o(i(e,"extensions"))),c.length&&(h.coordTimes=1===s.length?c[0]:c),f.length&&(h.heartRates=1===s.length?f[0]:f),{type:"Feature",properties:h,geometry:{type:1===s.length?"LineString":"MultiLineString",coordinates:1===s.length?s[0]:s}}}}(d[c]))&&v.features.push(f);for(c=0;c<m.length;c++)(f=function(e){var t=n(e,"rtept");if(t.line){var r=a(e);l(r,o(i(e,"extensions")));return{type:"Feature",properties:r,geometry:{type:"LineString",coordinates:t.line}}}}(m[c]))&&v.features.push(f);for(c=0;c<g.length;c++)v.features.push(function(e){var t=a(e);return l(t,s(e,["sym"])),{type:"Feature",properties:t,geometry:{type:"Point",coordinates:p(e).coordinates}}}(g[c]));return v}}}();e.exports=r}),sr={geojson:Ae,topojson:Ie,csv:Re,gpx:Oe,kml:Fe,wkt:_e,polyline:Me};Ie.parse=ke,Re.parse=Le,Oe.parse=Pe,Fe.parse=je,_e.parse=Ue,Me.parse=Be,e.Formats=sr,Object.defineProperty(e,"__esModule",{value:!0}),"undefined"!=typeof console&&console.log("maptalks.formats v0.2.0, requires maptalks@^0.25.0.")});